<script>
window.addEventListener("DOMContentLoaded", function () {
  if (!window.Telegram || !window.Telegram.WebApp) {
    alert("‚ùå Telegram WebApp not available. Please open from Telegram bot.");
    return;
  }

  const tg = window.Telegram.WebApp;
  tg.ready();        // ‚úÖ Signal Telegram you‚Äôre ready
  tg.expand();       // ‚úÖ Expand WebApp fullscreen

  const userId = tg.initDataUnsafe?.user?.id;

  // üîí Disable buttons first
  const mt5Form = document.getElementById("mt5Form");
  const riskForm = document.getElementById("riskForm");

  const mt5Button = mt5Form?.querySelector("button");
  const riskButton = riskForm?.querySelector("button");

  if (mt5Button) mt5Button.disabled = true;
  if (riskButton) riskButton.disabled = true;

  // ‚úÖ If user ID is found
  if (userId) {
    document.getElementById("user_id").value = userId;
    document.getElementById("user_id_risk").value = userId;

    if (mt5Button) mt5Button.disabled = false;
    if (riskButton) riskButton.disabled = false;
  } else {
    alert("‚ùå Failed to detect Telegram user ID.");
    return;
  }

  // ‚úÖ MT5 Form submit
  mt5Form?.addEventListener("submit", async function (e) {
    e.preventDefault();
    const formData = new FormData(mt5Form);
    try {
      const response = await fetch(mt5Form.action, {
        method: "POST",
        body: formData
      });
      const result = await response.json();
      if (result.success) {
        alert("‚úÖ MT5 details saved successfully!");
        mt5Form.reset();
      } else {
        alert("‚ùå Failed to save MT5 details.");
      }
    } catch (error) {
      alert("‚ùå Network error while saving MT5 details.");
    }
  });

  // ‚úÖ Risk Form submit
  riskForm?.addEventListener("submit", async function (e) {
    e.preventDefault();
    const formData = new FormData(riskForm);
    try {
      const response = await fetch(riskForm.action, {
        method: "POST",
        body: formData
      });
      const result = await response.json();
      if (result.success) {
        alert("‚úÖ Risk settings saved successfully!");
        riskForm.reset();
      } else {
        alert("‚ùå Failed to save risk settings.");
      }
    } catch (error) {
      alert("‚ùå Network error while saving risk settings.");
    }
  });
});
</script>
